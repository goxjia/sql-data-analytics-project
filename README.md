# SQL 数据分析与报告仓库

该存储库提供了全面的 SQL 脚本集合，旨在关系型数据库中进行深入的数据探索、分析和报告。对于希望快速探索、细分和有效分析数据的数据分析师和 BI 专业人员来说，这是一个宝贵的资源。每个脚本都侧重于一个特定的分析主题，并演示了 SQL 查询的最佳实践。

## 目录

1.  [维度探索](#1-维度探索)
2.  [日期范围探索](#2-日期范围探索)
3.  [度量探索（关键指标）](#3-度量探索关键指标)
4.  [量级分析](#4-量级分析)
5.  [排名分析](#5-排名分析)
6.  [随时间变化分析](#6-随时间变化分析)
7.  [累积分析](#7-累积分析)
8.  [绩效分析（同比，环比）](#8-绩效分析同比环比)
9.  [数据细分分析](#9-数据细分分析)
10. [部分到整体分析](#10-部分到整体分析)
11. [产品报告 (`report_products`)](#11-产品报告-report_products)
12. [客户报告 (`report_customers`)](#12-客户报告-report_customers)

---

## 洞察与分析细分

以下是此仓库中 SQL 脚本执行的分析的详细概述：

### 1. 维度探索

此部分侧重于理解维度表中的唯一值，为您的数据分类结构提供基础洞察。

* **客户国家**: 检索客户来源国家的唯一列表。
* **产品类别**: 列出类别、子类别和产品名称的唯一组合。

### 2. 日期范围探索

此部分确定关键数据点的时间边界，帮助您了解历史数据的范围。

* **订单日期**: 识别最早和最晚的订单日期，并计算它们之间的总持续月数。
* **客户出生日期**: 找出最年长和最年轻客户的出生日期，并计算他们当前的年龄。

### 3. 度量探索（关键指标）

此部分计算聚合指标，以快速洞察整体趋势和潜在异常。

* **Total Sales (总销售额)**: 计算所有销售额的总和。
* **Total Quantity Sold (总销售数量)**: 确定销售商品的总数量。
* **Average Selling Price (平均销售价格)**: 计算所有销售的平均价格。
* **Total Number of Orders (总订单数)**: 计算不同订单的总数。
* **Total Products (总产品数)**: 计算唯一产品的总数。
* **Total Customers (总客户数)**: 计算维度表中的客户总数，以及已下订单的客户总数。
* **关键业务指标报告**: 生成一份综合报告，显示所有关键指标，包括 Total Sales (总销售额)、Total Quantity (总数量)、Average Price (平均价格)、Total Orders (总订单数)、Total Products (总产品数) 和 Total Customers (总客户数)。

### 4. 量级分析

此部分根据特定维度量化数据并对结果进行分组，非常适合理解跨类别的数据分布。

* **按国家/地区划分的客户数**: 计算每个国家的客户总数。
* **按性别划分的客户数**: 计算每个性别的客户总数。
* **按类别划分的产品数**: 计算每个类别中的产品总数。
* **按类别划分的平均成本**: 计算每个类别中产品的平均成本。
* **按类别划分的收入**: 确定每个产品类别产生的总收入。
* **按客户划分的收入**: 计算每个客户产生的总收入。
* **按国家/地区划分的销售商品**: 显示不同国家/地区销售商品的分布。

### 5. 排名分析

此部分根据性能或其他指标对项目（例如产品、客户）进行排名，有助于识别表现最佳或最差的项。

* **按收入排名前 5 的产品**: 使用 `LIMIT` 和 `RANK()` 等窗口函数识别收入最高的 5 种产品。
* **销售额最差的 5 种产品**: 找出销售额最差的 5 种产品。
* **收入排名前 10 的客户**: 列出收入最高的 10 位客户。
* **订单最少的客户**: 识别下订单最少的 3 位客户。

### 6. 随时间变化分析

此部分跟踪关键指标随时间变化的趋势、增长和变化，对于时间序列分析和识别季节性至关重要。

* **销售业绩随时间变化**: 使用 `YEAR()`/`MONTH()`、 和 `DATE_FORMAT()` 函数按年和月聚合，分析 Total Sales (总销售额)、Total Customers (总客户数) 和 Total Quantity (总数量) 随时间的变化。

### 7. 累积分析

此部分计算关键指标的运行总计或移动平均值，以累积方式跟踪性能，有助于增长分析或识别长期趋势。

* **Running Total and Moving Average Sales (运行总计和移动平均销售额)**: 计算每年的 Total Sales (总销售额)、销售额的运行总计以及随时间变化的平均价格。

### 8. 绩效分析（同比，环比）

此部分通过将当前销售额与平均销售额和上一年销售额进行比较，衡量产品随时间变化的绩效，非常适合基准测试和识别高绩效实体。

* **年度产品绩效**: 按年份分析产品销售额，使用 `LAG()` 将 `current_sales` 与 `avg_sales`（按产品分区）和 `py_sales` (上一年销售额) 进行比较。它还包含一个 `CASE` 语句，用于指示销售额是“高于平均水平”、“低于平均水平”、“增加”、“减少”还是“无变化”。

### 9. 数据细分分析

此部分将数据分组为有意义的类别，以获取有针对性的洞察，从而实现客户细分、产品分类或区域分析。

* **产品成本细分**: 将产品细分为成本范围（“低于 100”、“100-500”、“500-1000”、“高于 1000”），并计算每个范围内的产品数量。
* **客户消费细分**: 根据客户的消费行为和生命周期将客户分为“VIP”、“Regular”和“New”细分，然后计算每个组中的客户总数。VIP 客户的交易历史至少 12 个月且总销售额超过 €5,000；Regular 客户的交易历史至少 12 个月且总销售额等于或低于 €5,000；New 客户的生命周期少于 12 个月。

### 10. 部分到整体分析

此部分比较跨维度的性能或指标，以评估类别之间的差异，适用于 A/B 测试或区域比较。

* **类别对总销售额的贡献**: 计算每个类别的 Total Sales (总销售额)、总销售额以及每个类别对总销售额的贡献百分比。

### 11. 产品报告 (`report_products`)

此 SQL 视图提供了一个全面且整合的产品性能和特性视图。

**目的：**
* 整合关键产品指标和行为。

**亮点：**
* 收集产品名称、类别、子类别和成本等基本字段。
* 根据收入将产品细分为“High-Performers”(总销售额 > €50,000)、“Mid-Range”（€10,000 <= 总销售额 <= €50,000）或“Low-Performers”（总销售额 < €10,000）。
* 聚合产品级指标，包括：
    * Total orders (总订单数)
    * Total sales (总销售额)
    * Total quantity sold (总销售数量)
    * Total unique customers (总独立客户数)
    * Lifespan (in months) (生命周期（月）) (从第一个到最后一个订单日期)
    * Average selling price (平均销售价格)
* 计算有价值的关键绩效指标 (KPIs)：
    * Recency (months since last sale) (距上次销售的月数)
    * Average Order Revenue (AOR) (平均订单收入)
    * Average Monthly Revenue (平均每月收入)

### 12. 客户报告 (`report_customers`)

此 SQL 视图提供有关客户行为和人口统计的详细洞察。

**目的：**
* 整合关键客户指标和行为。

**亮点：**
* 收集客户姓名、年龄和交易详情等基本字段。
* 将客户细分为：
    * **Age Groups (年龄组)**: “Under 20”(20 岁以下)、“20-29”、“30-39”、“40-49”和“50 and above”(50 岁及以上)。
    * **Customer Categories (客户类别)**: “VIP”（Lifespan (生命周期) >= 12 个月且 Total sales (总销售额) > €5,000）、“Regular”（Lifespan (生命周期) >= 12 个月且 Total sales (总销售额) <= €5,000）或“New”（Lifespan (生命周期) < 12 个月）。
* 聚合客户级指标，包括：
    * Total orders (总订单数)
    * Total sales (总销售额)
    * Total quantity purchased (总购买数量)
    * Total products purchased (总购买产品数)
    * Lifespan (in months) (生命周期（月）) (从第一个到最后一个订单日期)
* 计算有价值的关键绩效指标 (KPIs)：
    * Recency (months since last order) (距上次订单的月数)
    * Average order value (AOV) (平均订单价值)
    * Average monthly spend (平均每月支出)
